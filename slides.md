Node.js + Email
===============


## About Me

Matt Kopala

picture in Namibia

whereinthehellismatt.com

picture, Red X, "He's cooler than me"


PHP, now node.js

backpacked for 3.5 years: 2003 - 2006

* Freelance developer & consultant
* Founder of TaskBump : [https://taskbump.com]

Other

GitHub

* [@mkopala](http://twitter.com/#!/mkopala)
* [http://mattkopala.com](http://mattkopala.com)

Not an expert, not thorough coverage


## Goals

* Cover basic concepts of email for threading & replies
* How to handle email with node


## Email headers

MessageID

* Unique identifier for message.  
* Generated by mailer or SMTP service.

InReplyTo

*


## Sending email

NodeMailer - http://www.nodemailer.com/

    npm install nodemailer

<!--
The same author (Andris Reinman) has written these other **node.js** email-related modules:

* simplesmtp
* mail-parser
* mimelib
* dkim-signer, inbox, directmail, ...

(We'll cover)
-->


## Sending email (2)

```
// Set up the SMTP mailer
var nodemailer = require('nodemailer');
var opts = {
	host: '127.0.0.1',
	port: 8300
};
var transport = nodemailer.createTransport("SMTP", opts);

// Construct the email
var email = {
	to: 'Bob <bob@example.com>',
	from: 'Alice <alice@example.com>',
	subject: "Test Message",
	text: "Hello!\n\nThis is my email message.",
};

// Send the Email
transport.sendMail(email, function(err, status) {
	console.log(err, status);
	process.exit();
});
```


## Saving details
- MesageID


## Receiving: Postfix + IMAP


## Receiving: Node.js SMTP

```
var port = 8300;
var simplesmtp = require('simplesmtp');

function handleReq(req) {
  // Interesting mail handling code ...	
  console.log(req);
  
  req.accept()
}

server = simplesmtp.createSimpleServer({}, handleReq);
server.listen(port, function() {
  console.log("Email server running on port " + port);
});
```


## Processing replies

- InReplyTo
- Subject - "Re:"
- specified - "To:" address


## Email forwarding

- SMTP envelope


## Running on SMTP ports

haproxy

- listen on port 25
- extra IP address if running postfix as well


## Demo

- let users send mail to IP, push to screen


Comparison to postfix?
